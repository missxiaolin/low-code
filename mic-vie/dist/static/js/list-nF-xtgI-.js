import{_export_sfc as e,ref as l,useGeneralStore as a,useRouter as t,reactive as o,onMounted as s,resolveComponent as r,openBlock as i,createElementBlock as n,createBaseVNode as u,createVNode as d,withCtx as c,projectList as p,projectSave as v,api as m,projectGenerate as b,getAllVersions as g,updateVersion as f,createTextVNode as k,toDisplayString as y,Fragment as h,renderList as F,createBlock as _}from"./index-CR_1l9OE.js";const C=[{key:"type",default:1,type:"radio",label:"项目类型",disabled:!1,dataOptions:[{label:"pc",value:1},{label:"mobile",value:2,disabled:!0}],placeholder:"请选择项目类型",value:"",rules:[{required:!0,message:"请选择项目类型"}]},{key:"code",default:"",type:"input",label:"三字码",data:"",placeholder:"请输入项目三字码",value:"",disabled:!1,rules:[{required:!0,message:"请输入项目三字码",trigger:"blur"},{max:3,message:"请输入英文3个字符串",trigger:"blur"}]},{key:"name",default:"",type:"input",label:"项目名称",data:"",placeholder:"请输入项目名称",value:"",disabled:!1,rules:[{required:!0,message:"请输入项目名称",trigger:"blur"}]},{key:"desc",default:"",type:"input",label:"项目描述",data:"",placeholder:"请输入项目描述",value:"",disabled:!1,rules:[{required:!0,message:"请输入项目描述",trigger:"blur"}]},{key:"status",default:2,type:"radio",label:"是否禁用",disabled:!1,dataOptions:[{label:"禁用",value:1},{label:"开启",value:2}],value:"",rules:[{required:!0,message:"请选择是否禁用"}]}],w=[{key:"id",title:"ID",align:"center"},{key:"name",title:"项目名称",align:"center"},{key:"code",title:"三字码",align:"center"},{key:"desc",title:"项目描述",align:"center"},{key:"type_desc",title:"项目类型",align:"center"},{key:"version",title:"当前版本",align:"center"},{key:"status_desc",title:"项目状态",align:"center"},{key:"create_time",title:"创建时间",align:"center"},{key:"update_time",title:"修改时间",align:"center"},{key:"status",prop:"status",title:"状态",align:"center"},{key:"options",prop:"options",align:"center",title:"操作",width:"380px",fixed:"right",noEmptyValue:!0}],O={class:"vue-home-main"},V={class:"mu-search-container pall10"},x={class:"mu-search-form-button"},G={class:"mu-handle-content flex flex-1 flex-column"},S={class:"mb20"};const j=e({setup(e){let r=l(!1),i=l({id:"",version:"",type:1}),n=l(!1),u=l({id:"",version:""}),d=l([]);const c=a(),k=t();let y=l({}),h=l(!1),F=l(!1),_=l(!0);const O=l(C);let V=l({data:[],columns:w,total:0});const x=o([{value:"1",label:"电脑端"},{value:"2",label:"移动端"}]),G=o([{value:"1",label:"禁用"},{value:"2",label:"启用"}]),S=l({name:"",type:"",status:"",pageSize:10,page:1}),j=async()=>{let e=await p(S.value);e.success&&(V.value.data=e.model.list,V.value.total=e.model.count)},z=e=>{h.value=e,y.value={},F.value=!1,O.value[1].disabled=!1,_.value=!0};s((()=>{j()}));return{preview:e=>{let l="http://code.missxiaolin.com";["127.0.0.1","localhost","lcode.missxiaolin.com"].indexOf(window.location.hostname)>-1&&(l="http://127.0.0.1:8093"),window.open(l,"_blank")},generate:async()=>{if(!i.value.version)return void m.error("请输入版本号");if(!i.value.id)return void m.error("未找到项目");let e=await b(i.value);e.success?(m.success("项目发布中"),j(),r.value=!1):m.error(e.errorMessage)},goRoutePage:e=>{k.push({path:"/project/page",query:{projectId:e.id}})},popClick:z,edit:e=>{O.value[1].disabled=!0,y.value=e,_.value=!0,h.value=!0},detail:e=>{y.value=e,h.value=!0,F.value=!0,_.value=!1},popShowBottomBtn:_,projectDetail:y,popForm:O,table:V,typeOptions:x,statusOptions:G,searchForm:S,resetForm:()=>{S.value={name:"",type:"",status:"",pageSize:10,page:1},j()},formDisbled:F,popClick:z,dialogVisible:h,popSuccess:async e=>{let l=JSON.parse(JSON.stringify(e));y.value&&y.value.id&&(l.id=y.value.id);let a=await v(l);a.success?(c.getValidProject(),m.success(l.id?"修改成功":"添加成功"),y.value={},h.value=!1,j()):m.error(a.errorMessage)},getProjectList:j,handleCurrentChange:e=>{S.value.page=e+1,j()},versionGenerateFormOpen:r,versionGenerateForm:i,versionVersionFormOpen:n,versionVersionForm:u,versionAll:d,getVersionAll:async e=>{d.value=[];let l=await g({projectId:e,type:1});l.success&&(d.value=l.model)},setVersion:async()=>{let e=await f(u.value);e.success?(m.success("设置成功！"),n.value=!1,j()):m.error(e.errorMessage)}}}},[["render",function(e,l,a,t,o,s){const p=r("a-input"),v=r("mic-search-label"),m=r("a-col"),b=r("a-select"),g=r("a-row"),f=r("a-button"),C=r("mic-pop"),w=r("mic-search-table"),j=r("a-form-item"),z=r("a-form"),P=r("a-modal"),U=r("a-select-option");return i(),n("div",O,[u("div",V,[d(g,null,{default:c((()=>[d(m,{span:8},{default:c((()=>[d(v,{labelName:"项目名称"},{default:c((()=>[d(p,{value:t.searchForm.name,"onUpdate:value":l[0]||(l[0]=e=>t.searchForm.name=e),placeholder:"请输入项目名称"},null,8,["value"])])),_:1})])),_:1}),d(m,{span:8},{default:c((()=>[d(v,{labelName:"分类"},{default:c((()=>[d(b,{value:t.searchForm.type,"onUpdate:value":l[1]||(l[1]=e=>t.searchForm.type=e),options:t.typeOptions,placeholder:"请选择分类"},null,8,["value","options"])])),_:1})])),_:1}),d(m,{span:8},{default:c((()=>[d(v,{labelName:"状态"},{default:c((()=>[d(b,{value:t.searchForm.status,"onUpdate:value":l[2]||(l[2]=e=>t.searchForm.status=e),placeholder:"请选择分类",options:t.statusOptions},null,8,["value","options"])])),_:1})])),_:1})])),_:1}),u("div",x,[d(f,{onClick:t.resetForm},{default:c((()=>l[7]||(l[7]=[k("重置")]))),_:1},8,["onClick"]),d(f,{type:"primary",onClick:t.getProjectList},{default:c((()=>l[8]||(l[8]=[k("查询")]))),_:1},8,["onClick"])])]),u("div",G,[u("div",S,[d(C,{"btn-text":"创建项目",title:"项目",detail:t.projectDetail,"form-save-btn":"保存","btn-pop-form":t.popForm,"dialog-visible":t.dialogVisible,disabled:t.formDisbled,"is-show-bottom-btn":t.popShowBottomBtn,onPopClick:t.popClick,onSuccess:t.popSuccess},null,8,["detail","btn-pop-form","dialog-visible","disabled","is-show-bottom-btn","onPopClick","onSuccess"])]),d(w,{data:t.table.data,columns:t.table.columns,total:t.table.total,onHandleCurrentChange:t.handleCurrentChange},{status:c((e=>[k(y(1==e.row.status?"禁用":2==e.row.status?"启用":"发布中"),1)])),options:c((e=>[d(f,{link:"",size:"small",onClick:l=>t.edit(e.row)},{default:c((()=>l[9]||(l[9]=[k(" 编辑 ")]))),_:2},1032,["onClick"]),d(f,{link:"",size:"small",onClick:l=>t.detail(e.row),class:"ml10"},{default:c((()=>l[10]||(l[10]=[k(" 详情 ")]))),_:2},1032,["onClick"]),d(f,{link:"",size:"small",onClick:l=>t.goRoutePage(e.row),class:"ml10"},{default:c((()=>l[11]||(l[11]=[k(" 路由配置 ")]))),_:2},1032,["onClick"]),d(f,{link:"",size:"small",onClick:l=>{t.versionGenerateFormOpen=!0,t.versionGenerateForm.version="",t.versionGenerateForm.id=e.row.id},class:"ml10"},{default:c((()=>l[12]||(l[12]=[k(" 发布 ")]))),_:2},1032,["onClick"]),d(f,{link:"",size:"small",class:"ml10",onClick:l=>{t.versionVersionFormOpen=!0,t.versionVersionForm.version=e.row.version||"",t.versionVersionForm.id=e.row.id,t.getVersionAll(e.row.id)}},{default:c((()=>l[13]||(l[13]=[k(" 版本设置 ")]))),_:2},1032,["onClick"]),d(f,{link:"",size:"small",class:"ml10",onClick:l=>t.preview(e.row)},{default:c((()=>l[14]||(l[14]=[k(" 预览 ")]))),_:2},1032,["onClick"])])),_:1},8,["data","columns","total","onHandleCurrentChange"])]),d(P,{open:t.versionGenerateFormOpen,"onUpdate:open":l[4]||(l[4]=e=>t.versionGenerateFormOpen=e),onOk:t.generate,title:"版本发布"},{default:c((()=>[d(z,{model:t.versionGenerateForm},{default:c((()=>[d(j,{label:"版本号"},{default:c((()=>[d(p,{value:t.versionGenerateForm.version,"onUpdate:value":l[3]||(l[3]=e=>t.versionGenerateForm.version=e)},null,8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["open","onOk"]),d(P,{open:t.versionVersionFormOpen,"onUpdate:open":l[6]||(l[6]=e=>t.versionVersionFormOpen=e),onOk:t.setVersion,title:"版本设置"},{default:c((()=>[d(z,{model:t.versionVersionForm},{default:c((()=>[d(j,{label:"版本号"},{default:c((()=>[d(b,{value:t.versionVersionForm.version,"onUpdate:value":l[5]||(l[5]=e=>t.versionVersionForm.version=e)},{default:c((()=>[(i(!0),n(h,null,F(t.versionAll,(e=>(i(),_(U,{key:e,value:e.version},{default:c((()=>[k(y(e.version),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["open","onOk"])])}],["__scopeId","data-v-9fe7fd69"]]);export{j as default};
