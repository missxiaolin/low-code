var H=Object.defineProperty;var T=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var M=(r,e,t)=>e in r?H(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,W=(r,e)=>{for(var t in e||(e={}))D.call(e,t)&&M(r,t,e[t]);if(T)for(var t of T(e))V.call(e,t)&&M(r,t,e[t]);return r};import{_ as q,j as L,aA as A,k as O,n as Y,q as j,r as G,o as S,f as J,e as k,J as B,c as P,w as $,b as z}from"./index-BXSYDVKE.js";import{a as x,o as m,b as w}from"./dom-CF-1GTSJ.js";const R=r=>`${r}px`,I=(r,e,t,s)=>{const i=r!=null?r:document.createElement("canvas");i.width=e*s,i.height=t*s,i.style.width=R(e),i.style.height=R(t);const o=i.getContext("2d");return o&&o.setTransform(s,0,0,s,0,0),i},F=(r,e,t,s)=>{var c,l;if(!r||!r.style)return;const i=parseFloat(r.style.transform.match(new RegExp("(?<=X\\()(.+)","gi"))[0]),{height:o,scale:n,offset:h}=e;let a=0;return a=e&&e.direction=="TB"?t-(((c=r.parentElement)==null?void 0:c.offsetLeft)||0)-i:s-(((l=r.parentElement)==null?void 0:l.offsetTop)||0)-i,a=a-o+e.indicatorLineWidth,{coor:Math.floor((a-h)/n),dist:a}};class C{constructor(e,t,s,i=0){this.options=t,this.el=e,this.isMoveing=!1,this.guideLine="",this.coor=-1,this.constructGuide(s,i)}constructGuide(e,t=""){const{el:s}=this,i=document.createElement("div");i.title="\u53CC\u51FB\u5220\u9664\u53C2\u8003\u7EBF",x(i,"ruler-line"),this.guideLine=i;const{coor:o}=this;this.setLine(e,t),e&&this.coorChange("add",this.coor,o);let n=s.querySelector(".lines-wrapper");n||(n=document.createElement("div"),x(n,"lines-wrapper"),s.appendChild(n)),n.appendChild(i),m(i,"mousedown",this.moving.bind(this)),m(i,"dblclick",this.dblclick.bind(this))}moving(e){C.isMoveing=!0;const{options:t}=this;e.preventDefault(),e.stopPropagation();const{coor:s}=this,i=n=>{t.direction==="TB"?document.body.style.cursor="ew-resize":document.body.style.cursor="ns-resize",this.setLine(n)},o=()=>{C.isMoveing=!1,document.body.style.cursor="",w(document,"mousemove",i),w(document,"mouseup",o);const{coor:n}=this;n<0?this.coorChange("delete",s,s):this.coorChange("update",n,s)};m(document,"mousemove",i),m(document,"mouseup",o)}setLine(e,t=0){const{el:s,options:i,guideLine:o}=this,n=e?F(s,i,e.clientX,e.clientY):((h,a)=>{const{scale:c,offset:l}=a;return{coor:h,dist:parseFloat((h*c+l).toFixed(3))}})(t,i);i.direction==="TB"?o.style.left=R(n.dist):o.style.top=R(n.dist),o.innerHTML=`
        <div class="line-action">
          <span class="line-value">${n.coor}</span>
        </div>`,this.coor=n.coor}dblclick(e){e.preventDefault(),e.stopPropagation(),this.destroy()}coorChange(e,t,s){const{options:i}=this;i.coorChange&&i.coorChange(e,t,s)}show(){this.guideLine.style.display="block"}hide(){this.guideLine.style.display="none"}destroy(){const{guideLine:e,coor:t}=this;this.coorChange("delete",t,t),w(e,"mousedown",this.moving.bind(this)),w(e,"dblclick",this.dblclick.bind(this)),e.remove()}}class X{constructor(e,t){this.el=e,this.guideLines=[],this.indicatorValue="",this.indicator="",this.ruler={width:0,height:0},this.ctx="",this.canvas="",this.readonly="",this.options=W({direction:"TB",width:1e3,height:20,bgColor:"#0e1013",fontFamily:"sans-serif",fontSize:"10px",fontColor:"#90a0ae",strokeStyle:"rgba(161, 174, 179, 0.8)",lineWidth:.5,indicatorLineWidth:1,scale:1,offset:40,ratio:2},t),this.constructRuler()}constructRuler(){const{el:e,options:t}=this,{direction:s,width:i,height:o,ratio:n}=t,h=Math.max(s==="TB"?e.offsetWidth:e.offsetHeight,i),a=o;this.ruler.width=h,this.ruler.height=a;const c=I(null,h,a,n);x(c,"canvas-ruler"),e.appendChild(c),this.canvas=c,this.ctx=c.getContext("2d"),this.drawRuler(),m(c,"mouseenter",this.constructIndicator.bind(this)),m(c,"mousedown",this.createGuideLine.bind(this))}drawRuler(){const{ctx:e,options:t,ruler:s}=this,{width:i,height:o}=s;e.beginPath(),e.fillStyle=t.bgColor,e.fillRect(0,0,i,o),e.closePath(),e.beginPath(),e.font=`${t.fontSize} ${t.fontFamily}`,e.textAlign="left",e.fillStyle=t.fontColor,e.strokeStyle=t.strokeStyle,e.lineWidth=t.lineWidth,this.drawPoints(),e.stroke()}drawPoints(){const{ctx:e,options:t,ruler:s}=this,{width:i,height:o}=s,{offset:n,scale:h}=t,a=o/1.5,c=o/1.2;for(let l=0;l<=i;l+=1){const u=l-n;if(u<0)continue;let p=-1,g=-1;u%50==0?(p=Math.floor(u/h),g=0):u%25==0?g=a:u%5==0&&(g=c),g>=0&&(e.moveTo(l+.5,o+.5),e.lineTo(l+.5,g),p>-1&&e.fillText(`${p}`,l+2.5,o/1.5))}}constructIndicator(e){if(C.isMoveing)return;const{el:t,options:s,canvas:i}=this,o=document.createElement("div"),n=document.createElement("span");x(o,"ruler-indicator"),x(n,"indicator-value"),o.appendChild(n),this.indicator=o,this.indicatorValue=n,t.appendChild(o);const h=l=>{const u=F(t,s,l.clientX,l.clientY);o.style.left=R(u.dist),n.textContent=`${u.coor}`};h(e);const a=l=>{h(l)},c=()=>{w(i,"mousemove",a),w(i,"mouseout",c),o.remove()};m(i,"mousemove",a),m(i,"mouseout",c)}createGuideLine(e){e.preventDefault(),e.stopPropagation();const{el:t,options:s}=this;this.guideLines.push(new C(t,s,e))}setGuideLines(e){const{el:t,options:s}=this;e.forEach(i=>{this.guideLines.push(new C(t,s,null,i))})}setSize(e,t,s){const{el:i,options:o}=this;o.width=e,o.height=t,o.scale=s;const{direction:n,width:h,height:a,ratio:c}=o,l=Math.max(n==="TB"?i.offsetWidth:i.offsetHeight,h),u=a;this.ruler.width=l,this.ruler.height=u,I(this.canvas,l,u,c),this.drawRuler(),this.guideLines.forEach(p=>p.setLine(null,p.coor))}setScale(e){this.options.scale=e,this.drawRuler(),this.guideLines.forEach(t=>t.setLine(null,t.coor))}toggleGuide(e){const t=e?"show":"hide";this.guideLines.forEach(s=>s[t]())}clearGuides(){this.guideLines.forEach(e=>e.destroy()),this.guideLines=[]}destroy(){const{el:e,canvas:t}=this;this.clearGuides(),w(t,"mouseenter",this.constructIndicator.bind(this)),w(t,"mousedown",this.createGuideLine.bind(this)),e.remove()}}const _={class:"canvas-ruler-wp"},K=q({setup(r,{expose:e}){const t=L(null),s=L(null),i=L(null),o=L(null),n=L(!0),h=L(0),a=L(0),c=document.documentElement.clientWidth;let l={h:[],v:[]};const u=(d,v)=>{i.value?i.value.setSize(d,20,v.scale):(i.value=new X(t.value,{direction:"TB",width:d,scale:v.scale,coorChange:(f,y,b)=>{f==="add"?l.h.push(y):f==="update"&&y!==b?(l.h=l.h.filter(E=>E!==b),l.h.push(y)):f==="delete"&&(l.h=l.h.filter(E=>E!==y))}}),i.value.setGuideLines(l.h))},p=d=>{o.value?o.value.setSize(d.height,20,d.scale):(o.value=new X(s.value,{direction:"LR",width:d.height,scale:d.scale,coorChange:(v,f,y)=>{v==="add"?l.v.push(f):v==="update"&&f!==y?(l.v=l.v.filter(b=>b!==y),l.v.push(f)):v==="delete"&&(l.v=l.v.filter(b=>b!==f))}}),o.value.setGuideLines(l.v))};A(()=>{if(!t.value||!s.value)return;const d={width:1920,height:1080,scale:1},v=Math.max(d.width,c);u(v,d),p(d)});const g=d=>{const v=d.target;h.value=v.scrollLeft,a.value=v.scrollTop};return O(()=>{Y(()=>{const d=document.getElementById("editor");d==null||d.addEventListener("scroll",g)})}),j(()=>{const d=document.getElementById("editor");d==null||d.removeEventListener("scroll",g)}),e({setHRule:u,setVRule:p}),{toggleGuides:()=>{i.value&&o.value&&(n.value=!n.value,i.value.toggleGuide(n.value),o.value.toggleGuide(n.value))},hRulerWpRef:t,vRulerWpRef:s,hRuler:i,vRuler:o,visible:n,hScroll:h,vScroll:a}}},[["render",function(r,e,t,s,i,o){const n=G("EyeOutlined"),h=G("n-icon"),a=G("EyeInvisibleOutlined");return S(),J("div",_,[k("div",{ref:"hRulerWpRef",class:"ruler-wrapper h-container",style:B(`transform: translateX(-${s.hScroll}px);`)},null,4),k("div",{ref:"vRulerWpRef",class:"ruler-wrapper v-container",style:B(`transform: rotate(90deg) translateX(-${s.vScroll}px);`)},null,4),k("div",{title:"\u5207\u6362\u53C2\u8003\u7EBF",class:"ruler-corner",onClick:e[0]||(e[0]=(...c)=>s.toggleGuides&&s.toggleGuides(...c))},[s.visible?(S(),P(h,{key:0},{default:$(()=>[z(n)]),_:1})):(S(),P(h,{key:1},{default:$(()=>[z(a)]),_:1}))])])}]]);export{K as default};
