const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["static/js/layer-DtYg_PAD.js","static/js/index-BIK19g1N.js","static/css/index-D_IH-oG1.css","static/css/layer-Bo_cQZpI.css","static/js/grid-CatgIpq_.js","static/css/grid-B57TZmu8.css","static/js/index-9Gg7nd6W.js","static/js/dom-CjIf7Xwc.js","static/css/index-CyCOOJJ3.css","static/js/editScale-4Ub-UDfg.js","static/css/editScale-BGWFNuB0.css","static/js/index-DtpugCDi.js","static/js/dpPage-BGiVgsEY.js","static/js/code-generator-factory-CYLGuIWM.js","static/js/index.browser-CcxBvUBP.js","static/css/index-YQ1rOcM3.css","static/js/index-GHzrLork.js","static/js/index-JkvSJl3p.js","static/css/index-DkpSJT6C.css","static/js/index-BKWvvwxt.js","static/css/index-CWUGRfyk.css","static/js/code-Bg6cTblQ.js","static/js/xml-fold-DUvrGRZj.js","static/css/xml-fold-D05cK1KH.css","static/js/parser-html-BhNY2pAy.js","static/css/code-P2i0O_fr.css"])))=>i.map(i=>d[i]);
var C=(R,S,w)=>new Promise((O,J)=>{var I=E=>{try{k(w.next(E))}catch(b){J(b)}},V=E=>{try{k(w.throw(E))}catch(b){J(b)}},k=E=>E.done?O(E.value):Promise.resolve(E.value).then(I,V);k((w=w.apply(R,S)).next())});import{ag as W,a0 as se,d as p,_ as G,a as y,j as u,k as q,p as ae,r as f,o as L,f as F,b as g,w as le,s as ce,e as D,D as de,J as ue,H as he,I as _e,c as $,X as ve,G as U,ah as me,ai as pe,a7 as ye,af as Ee,__tla as fe}from"./index-BIK19g1N.js";import{b as we,p as Ce}from"./dpPage-BGiVgsEY.js";import{p as Se,E as be,c as ge,d as De,g as Oe}from"./code-generator-factory-CYLGuIWM.js";import{c as ke}from"./index.browser-CcxBvUBP.js";let H,B,z,Ne=Promise.all([(()=>{try{return fe}catch(R){}})()]).then(()=>C(void 0,null,function*(){function R(r){if(r){const e=r.attributes.lc_id.nodeValue;let n=window.templateSourceMap[e];return!n&&window.tree&&(n=window.tree[e]),n}return null}function S(r){return Object.prototype.toString.apply(r)==="[object Object]"}function w(r){return Object.keys(r)[0]}function O(r){return r[w(r)]}function J(r){const e=function(n){return O(n).lc_id}(r);return!!window.templateSourceMap[e]}function I(r){return r.attributes&&r.attributes.lc_id?r:r.parentNode?I(r.parentNode):null}z=function(r){return r.querySelector(".title")&&(r=r.querySelector(".title")),r.attributes.lc_id?R(r):{[r.localName]:{__text__:r.innerText,class:r.className}}},H=function(){return"@#$!"};function V(r){window.tree||(window.tree={}),function(e){(function n(t){for(const o in t)if(t.hasOwnProperty(o)){const i=t[o];if(t.hasOwnProperty("__key__")&&t.__key__==="__children"&&S(i)&&delete t.__key__,o==="lc_id"&&t.hasOwnProperty("__key__")){const s=t.__key__,h={[s]:t};h.__proto__=t.__proto__,delete t.__key__,window.tree[i]=h}else o==="__children"?t.__children.forEach(s=>{s.__key__=o,n(s)}):S(i)&&(i.__key__=o,n(i))}})(e)}(r)}function k(r){return R(I(r))}class E{constructor(e){this.rawVueInfo={},this.isOnload=!1,this.editMode=!0,this.eventEmitter=new be,this.currentPointPositionAfterIndex=-1,this.renderStack=[],this.redoStack=[],this.externalJS={},this.customCss="",this.eventNode={},this.customData={},this.componentOptions={},this.dropIninFunction=e&&e.dropIninFunction?e.dropIninFunction:""}subscribeEventListener(e,n){this.eventEmitter.on(e,n)}getComponentOptions(){return this.componentOptions}onSelectElement(e){return this.subscribeEventListener("selected",e),this}onRootElementMounted(e){return this.subscribeEventListener("mounted",e),this}onCodeCreated(e){return this.subscribeEventListener("codeCreated",e),this}onCodeStructureUpdated(e){return this.subscribeEventListener("codeStructureUpdated",e),this}onMerged(e){return this.subscribeEventListener("onMerged",e),this}onNodeDeleted(e){return this.subscribeEventListener("onNodeDeleted",e),this}setDropInfo(e){this.currentPointDropInfo=e}saveCssCodeOnly(e){return this.customCss=e||"",this}saveJSCodeOnly(e){return this.externalJS=e||"",this}saveEventNode(e){return this.eventNode=e,this}saveJsData(e){return this.customData=e,this}setEditMode(e,n){this.editMode=e,this.mountedEle=n,this.reRender()}reRender(){return this._render(this._rawDataStructure),this}asyncReRender(){return C(this,null,function*(){return yield this._render(this._rawDataStructure),this})}render(e){return this._render(e),this}_render(e){return C(this,null,function*(){this._rawDataStructure=e;const n=W(e);this.eventEmitter.emit("codeStructureUpdated",n),this.initCodeGenerator();let t=yield this.codeGenerator.outputVueCodeWithJsonObj(e);t=t.replace(/:\s*\(([\w\s,]*)\)\s*=>/g,"($1)");let o=t.replace(/\s{1}lc_id=".+?"/g,"");return o=o.replace(/\s{1}vccName=".+?"/g,""),o=o.replace(/\s{1}component_name=".+?"/g,""),o=o.replace(/\s{1}lc-mark/g,""),o=o.replace(/\s{1}div-lc-mark/g,""),this.eventEmitter.emit("codeCreated",o),this.enableEditMode(),this.flatDataStructure(e),this})}enableEditMode(){const e=this.getControlPanelRoot();this.enableDelayTask&&clearTimeout(this.enableDelayTask),this.enableDelayTask=setTimeout(()=>{this.eventEmitter.emit("mounted",e),this.initComonentsEvent()},500)}initComonentsEvent(){this.getControlPanelRoot(),this.isOnload||(this.initDropEvent(),this.isOnload=!0)}markElement(e){if(this.currentEditElement&&this.currentEditElement.classList.remove("mark-element"),this.getControlPanelRoot().querySelectorAll("[lc_id]").forEach(n=>{n.classList.remove("mark-element")}),e){this.currentEditElement=e;const n=this.markElementInner(e);this.rawVueInfo=n;const t=W(n);this.eventEmitter.emit("selected",t)}else this.eventEmitter.emit("selected",null)}markElementInner(e){e.classList.add("mark-element");const n=k(e);let t=w(n);return n[Object.keys(n)[0]].vccName&&(t=n[Object.keys(n)[0]].vccName),e.setAttribute("lc-component-name",t),n}clearElementSelect(){this.markElement(null)}initDropEvent(){const e=this.getControlPanelRoot();e.addEventListener("dragenter",n=>{n.preventDefault()}),e.addEventListener("dragleave",n=>{n.preventDefault()}),e.addEventListener("dragover",n=>{n.preventDefault()}),e.addEventListener("drop",n=>{let t=n.dataTransfer.getData("text/plain").split("@#$!");const o=t[2],i={"mic-shape":{vccComponentName:t[3],vccName:o,":defaultStyle":`{'top':20,'left':20,'width':${Number(t[4])},'height':${Number(t[5])}}`,lc_id:"micShape",__children:[]}};J(i)&&this.initDropCode(i),this.updateCodeStructure(i)})}initDropCode(e){(function(n){const t=w(n),o=n[t],i=Se[t];if(i){for(const s in i)if(i.hasOwnProperty(s)){const h=i[s];o[s]=h}}})(e),function(n,t){let o=t;(function i(s){if(S(s)){for(const m in s)if(s.hasOwnProperty(m)){const c=s[m];if(m=="lc_id"){const _=s[m],N=ke("1234567890abcdefghijklmnopqrstuvwxyz",10)();o=o.replace(_,N),s[m]=N}else S(c)?i(c):(h=c,Object.prototype.toString.apply(h)==="[object Array]"&&c.forEach(_=>i(_)))}}var h})(n)}(e,""),V(e)}updateCodeStructure(e){const n=this.getControlPanelRoot().childNodes[0];n&&(function(t,o,i=-1,s=()=>{}){t&&o&&(t.__children||(t.__children=[]),i>-1?t.__children.splice(i,0,o):t.__children.push(o),s(),o.__proto__={parentCodeNode:t})}(O(k(n)),e,-1,()=>{this.eventEmitter.emit("onMerged")}),this.render(this._rawDataStructure))}flatDataStructure(e){V(e)}initCodeGenerator(){this.codeGenerator=ge(),this.codeGenerator.setExternalJS(this.externalJS),this.codeGenerator.setExternalCss(this.customCss),this.codeGenerator.setEventNode(this.eventNode),this.codeGenerator.setCustomData(this.customData)}createMountedElement(){const e=this.getControlPanelRoot();return this.styleNodeName&&e.setAttribute("class",this.styleNodeName),e}getControlPanelRoot(){return document.getElementById("render-control-panel")}appLoad(e,n){const t={"/main.vue":De(e,this._rawDataStructure),"/events.json":`${JSON.stringify(this.eventNode)}`},o=Oe(t),i=se(p(()=>window["vue3-sfc-loader"].loadModule("/main.vue",o)));window.loadApp(i),i.mount(n)}setKeyValue(e,n,t){if(!e||!n)return;const o=O(window.tree[t]);return o[e]=n,this.render(this._rawDataStructure),o.lc_id&&setTimeout(()=>{this.selectElement(o.lc_id)},10),this}saveAttribute(e,n,t=!0){const o=e,i=O(window.tree[n]);for(const s in i)i.hasOwnProperty(s)&&s!="__children"&&s!="lc-mark"&&s!="lc_id"&&s!="div-lc-mark"&&s!="vccName"&&!S(i[s])&&delete i[s];return o.forEach(s=>{i[s.key]=s.value}),this.render(this._rawDataStructure),i.lc_id&&t&&setTimeout(()=>{this.selectElement(i.lc_id,i.vccName)},10),this}selectElement(e){const n=this.getControlPanelRoot().querySelector(`[lc_id="${e}"]`);n&&setTimeout(()=>{n.click()})}getRawDataStructure(){return this._rawDataStructure}getRawVueInfo(){return this.rawVueInfo}}const b={components:{Layer:p(()=>y(()=>import("./layer-DtYg_PAD.js"),__vite__mapDeps([0,1,2,3]))),Grid:p(()=>y(()=>import("./grid-CatgIpq_.js"),__vite__mapDeps([4,1,2,5]))),ruler:p(()=>y(()=>import("./index-9Gg7nd6W.js"),__vite__mapDeps([6,1,2,7,8]))),editScale:p(()=>y(()=>import("./editScale-4Ub-UDfg.js"),__vite__mapDeps([9,1,2,10]))),micShape:p(()=>y(()=>import("./index-BIK19g1N.js").then(r=>C(void 0,null,function*(){return yield r.__tla,r})).then(r=>r.aL),__vite__mapDeps([1,2]))),rawComponents:p(()=>y(()=>import("./index-DtpugCDi.js"),__vite__mapDeps([11,1,2,12,13,14,15]))),attributeInput:p(()=>y(()=>import("./index-GHzrLork.js").then(r=>C(void 0,null,function*(){return yield r.__tla,r})),__vite__mapDeps([16,1,2,17,18]))),toolsBar:p(()=>y(()=>import("./index-BKWvvwxt.js"),__vite__mapDeps([19,1,2,20]))),lcCode:p(()=>y(()=>import("./code-Bg6cTblQ.js"),__vite__mapDeps([21,1,2,22,23,24,25])))},props:{initCodeEntity:{type:Object,default:()=>({})},asyncComponents:{type:Array,default:()=>[]}},emits:["updateCodeEntity","save","preview"],setup(r,{emit:e}){const n=u(!1);let t=u(!1);u({});let o=u({});const i=u(""),s=u(null),h=u(null),m=u(.5);window.vccScale=m.value;const c=u({width:0,height:0,hWidth:0}),_=new E,N=u(""),j=u(""),T=u([]),P=u(null),re=u(null),oe=(v,a=!1)=>{let d={};return T.value=v||[],v.forEach(l=>{["string","array","object"].includes(l.key)||l.key==="string"?d[l.key]=l.value:l.key==="number"?d[l.key]=Number(l.value):l.key==="boolean"?d[l.key]=l.value==="true"||l.value===!0:d[l.key]=l.value}),a&&(_.saveJsData(d),this.renderCode()),d},ie=()=>{var v;_.onRootElementMounted(a=>{document.getElementsByTagName("body")[0].addEventListener("click",Pe=>{_.clearElementSelect()});const d=document.documentElement.clientWidth,l=Math.max(a.offsetWidth,d);h.value&&(c.value.scale=m.value,c.hWidth=l,c.value.height=a.offsetHeight+150,c.value.width=l,h.value.setHRule(l+250,c.value),h.value.setVRule(c.value))}).onMerged(()=>{}).onCodeCreated(a=>{i.value=a}).onCodeStructureUpdated(a=>{var d,l;o.value=a.template.__children[0].div,a.value=JSON.parse(JSON.stringify(a)),d="tem_json",l=JSON.stringify(a.value),e("updateCodeEntity",{key:d,data:l})}).onNodeDeleted(()=>{s.value=null}).onSelectElement(a=>{s.value=a}).saveCssCodeOnly((v=r.initCodeEntity.css?r.initCodeEntity.css:"",N.value=v,v)).saveJSCodeOnly((a=>{try{let d=a;return j.value=a,d}catch(d){}})(r.initCodeEntity.JSCode?r.initCodeEntity.JSCode:"")).saveEventNode(r.initCodeEntity.eventNode).saveJsData(oe(r.initCodeEntity.customData||[])).render(r.initCodeEntity.codeStructure?r.initCodeEntity.codeStructure:{template:{lc_id:"root",__children:[{div:{class:"container",lc_id:"container",style:"min-height: 100%;"}}]}}),window.vccMainPanelProvider=_};return q(()=>{Promise.all([y(()=>import("./load-DwytJNh1.js"),[])]).then(v=>{ie(),P.value=r.initCodeEntity.eventNode})}),ae("mainPanelProvider",_),{preview:()=>{e("preview")},save:()=>{e("save")},showCodeDialogVisible:()=>{t.value=!0},codeDialogVisible:t,editorRef:re,ruleRef:h,canvas:c,scale:m,handleScaleChange:v=>{window.vccScale=v,c.value.scale=v,m.value=v,h.value.setHRule(c.hWidth,c.value),h.value.setVRule(c.value);const a=s.value;_.asyncReRender(),a&&Object.keys(a).length>0&&setTimeout(()=>{_.selectElement(a[Object.keys(a)[0]].lc_id)},10)},dCode:i,comJson:o,getAttr:v=>{const a=JSON.parse(JSON.stringify(v["mic-shape"]));return Object.keys(a).forEach(d=>{d.startsWith(":")&&(a[d.substring(1)]=me(a[d]))}),a},isFullWidth:n}}},A=()=>{pe(r=>({cad673f0:r.scale}))},M=b.setup;b.setup=M?(r,e)=>(A(),M(r,e)):A;const K={class:"editor-box vcc-main"},X={class:"vcc-main-content"},Q={class:"base-component-container"},Y={class:"vcc-main-container"},Z={id:"editor",class:"editor",ref:"editorRef"},ee={class:"preview-container"},te={id:"render-control-panel"},ne=["id","lc_id"];let x;x=G({name:"vcc-editor-d",components:{vccEditor:G(b,[["render",function(r,e,n,t,o,i){const s=f("tools-bar"),h=f("layer"),m=f("raw-components"),c=f("ruler"),_=f("mic-shape"),N=f("edit-scale"),j=f("attribute-input"),T=f("lcCode");return L(),F("div",K,[g(s,{class:"vcc-tools-bar",onShowCodeDialogVisible:t.showCodeDialogVisible,onOnShowLayer:e[0]||(e[0]=P=>t.isFullWidth=!t.isFullWidth),onSave:t.save,onPreview:t.preview},{default:le(()=>[ce(r.$slots,"toole",{},void 0,!0)]),_:3},8,["onShowCodeDialogVisible","onSave","onPreview"]),D("div",X,[g(h,{isFullWidth:t.isFullWidth},null,8,["isFullWidth"]),D("nav",Q,[g(m)]),D("div",Y,[D("div",Z,[g(c,{ref:"ruleRef"},null,512),D("div",ee,[D("div",te,[D("div",{class:de(t.comJson.class),id:t.comJson.id,lc_id:t.comJson.lc_id,style:ue(t.comJson.style)},[t.comJson.__children&&t.comJson.__children.length>0?(L(!0),F(he,{key:0},_e(t.comJson.__children,P=>(L(),$(_,ve({ref_for:!0},t.getAttr(P),{scale:t.scale}),null,16,["scale"]))),256)):U("",!0)],14,ne)])])],512),g(N,{scale:t.scale,onChange:t.handleScaleChange},null,8,["scale","onChange"])]),g(j)]),g(T,{codeDialogVisible:t.codeDialogVisible,"onUpdate:codeDialogVisible":e[1]||(e[1]=P=>t.codeDialogVisible=P),rawCode:t.dCode},null,8,["codeDialogVisible","rawCode"])])}],["__scopeId","data-v-31736e58"]])},setup(){let r=u(!1);const e=ye(),n=Ee();let t=u({}),o=u({codeStructure:JSON.parse('{"template":{"lc_id":"root","__children":[{"div":{"class":"container","id": "vcc-container","style": "width: 1920px; height: 1080px;background-color: #142A41;position: relative;","lc_id":"container","__children":[]}}]}}'),JSCode:`export default {
    setup() {

      return {};
    },
  };
  `,mode:1,css:"",eventNode:{},customData:[]});return q(()=>{C(this,null,function*(){let i=yield we({id:n.query.id,projectId:n.query.projectId});if(!i.success)return;const s=i.model;t.value=i.model,delete t.value.create_time,delete t.value.update_time,o.value.JSCode=s.script_json,o.value.css=s.css,o.value.codeStructure=JSON.parse(s.tem_json),o.value.customData=JSON.parse(s.customData),o.value.eventNode=JSON.parse(s.eventNode),r.value=!0})}),{codeInfoEntity:o,isShowVcc:r,updateCodeEntity:i=>{t.value[i.key]=i.data},save:()=>C(this,null,function*(){(yield Ce(t.value)).success&&e.push({path:"/dp/list"})}),preview:()=>{window.open("/dp/preview?id="+n.query.id+"&projectId="+n.query.projectId)}}}},[["render",function(r,e,n,t,o,i){const s=f("vccEditor");return t.isShowVcc?(L(),$(s,{key:0,asyncComponents:[],initCodeEntity:t.codeInfoEntity,onUpdateCodeEntity:t.updateCodeEntity,onSave:t.save,onPreview:t.preview},null,8,["initCodeEntity","onUpdateCodeEntity","onSave","onPreview"])):U("",!0)}]]),B=Object.freeze(Object.defineProperty({__proto__:null,default:x},Symbol.toStringTag,{value:"Module"}))}));export{Ne as __tla,H as a,B as d,z as g};
